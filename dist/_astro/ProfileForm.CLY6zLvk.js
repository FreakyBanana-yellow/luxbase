import{j as a}from"./jsx-runtime.DresmuL2.js";import{r as o}from"./index.DAN0nmsk.js";import{s as d,w as z}from"./agency.BeFzy3Js.js";function L({overrideCreatorId:t=null,agencyId:p=null}){const[m,u]=o.useState(!0),[f,i]=o.useState(""),[_,w]=o.useState(!1),[E,N]=o.useState(null),[j,S]=o.useState(!1),[e,h]=o.useState({creator_name:"",email:"",password:""}),b=r=>{const{name:s,value:c}=r.target;h(l=>({...l,[s]:c}))};o.useEffect(()=>{(async()=>{u(!0),i(""),w(!1);try{const{data:{user:r},error:s}=await d.auth.getUser();if(s||!r){i("Bitte einloggen, um dein Profil zu bearbeiten."),u(!1);return}const c=t||r.id;N(c),S(!t||t===r.id);const{data:l}=await d.from("creator_config").select("creator_name, email").eq("creator_id",c).maybeSingle(),x=t?"":r.email??"";h(g=>({...g,creator_name:l?.creator_name??"",email:l?.email??x,password:""}))}catch(r){i(r?.message||"Unbekannter Fehler beim Laden")}finally{u(!1)}})()},[t]);async function v(r){r.preventDefault(),i(""),w(!1);try{const{data:{user:s},error:c}=await d.auth.getUser();if(c||!s){i("Nicht eingeloggt.");return}const l=E;if(!l)throw new Error("Kein Zielkonto gefunden");const x={creator_id:l,creator_name:e.creator_name?.trim()||null,email:e.email?.trim()||null,updated_at:new Date().toISOString()},{error:g}=await d.from("creator_config").upsert(x,{onConflict:"creator_id"});if(g)throw g;if(j){if(e.email&&e.email!==(s.email??"")){const{error:n}=await d.auth.updateUser({email:e.email});if(n)throw new Error(`E-Mail-Update: ${n.message}`)}if(e.password&&e.password.length>=6){const{error:n}=await d.auth.updateUser({password:e.password});if(n)throw new Error(`Passwort-Update: ${n.message}`)}}if(h(n=>({...n,password:""})),w(!0),p&&t)try{await z({agency_id:p,action:"update_profile",target_creator_id:l})}catch{}}catch(s){i(s?.message||"Speichern fehlgeschlagen")}}return a.jsxs("form",{onSubmit:v,className:"space-y-6",children:[m&&a.jsx("div",{className:"animate-pulse text-zinc-300",children:"Lade Profil…"}),f&&a.jsx("div",{className:"p-3 rounded-lg bg-red-900/50 border border-red-700 text-red-100",children:f}),_&&a.jsx("div",{className:"p-3 rounded-lg bg-emerald-900/40 border border-emerald-700 text-emerald-100",children:"Gespeichert ✅"}),a.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[a.jsx(y,{name:"creator_name",label:"Anzeigename",value:e.creator_name,onChange:b}),a.jsx(y,{name:"email",label:"E-Mail",type:"email",value:e.email,onChange:b})]}),a.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[a.jsx(y,{name:"password",label:j?"Neues Passwort (min. 6 Zeichen)":"Neues Passwort (nur Eigenprofil)",type:"password",value:e.password,onChange:b}),a.jsx("div",{})]}),a.jsxs("div",{className:"flex gap-3",children:[a.jsx("button",{type:"submit",className:"px-5 py-3 rounded-2xl bg-yellow-500/90 hover:bg-yellow-400 text-black font-medium shadow",disabled:m||!!e.password&&e.password.length>0&&e.password.length<6,title:e.password&&e.password.length<6?"Passwort zu kurz":void 0,children:"Speichern"}),a.jsx("button",{type:"button",onClick:()=>location.reload(),className:"px-5 py-3 rounded-2xl bg-zinc-800 hover:bg-zinc-700 border border-zinc-700 text-zinc-100",disabled:m,children:"Verwerfen"})]})]})}function y({label:t,name:p,value:m,onChange:u,type:f="text"}){return a.jsxs("label",{className:"block",children:[a.jsx("span",{className:"text-sm text-yellow-200/90",children:t}),a.jsx("input",{className:"mt-1 w-full rounded-xl bg-zinc-900 border border-yellow-600/30 px-4 py-2 text-yellow-50 placeholder-zinc-500 focus:outline-none focus:ring-2 focus:ring-yellow-500/60",name:p,value:m??"",type:f,onChange:u})]})}export{L as default};
