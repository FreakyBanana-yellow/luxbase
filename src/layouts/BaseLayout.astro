---
import "../styles/global.css";
---
<html lang="de" class="scroll-smooth">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Luxbase</title>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600&family=Playfair+Display:wght@400;700&display=swap" rel="stylesheet" />
    <meta name="theme-color" content="#0d0d0d" />

    <!-- Supabase Client -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
      window.supabase = supabase.createClient(
        import.meta.env.PUBLIC_SUPABASE_URL,
        import.meta.env.PUBLIC_SUPABASE_ANON_KEY
      );
    </script>
  </head>
  <body class="min-h-screen flex flex-col bg-luxblack text-white font-sans">
    <!-- Header -->
    <header class="sticky top-0 z-50 flex items-center justify-between px-6 py-4 bg-black/70 backdrop-blur shadow-md">
      <h1 class="text-2xl md:text-3xl font-serif font-bold text-luxgold">Luxbase</h1>
      <button id="openLogin" class="text-sm px-4 py-2 border border-luxgold text-luxgold rounded hover:bg-luxgold hover:text-luxblack transition">Login</button>
    </header>

    <!-- Slot for page-specific content -->
    <main class="flex-1"><slot /></main>

    <!-- Footer -->
    <footer class="text-center text-sm text-luxgold/70 py-8 border-t border-luxgray">
      © {new Date().getFullYear()} Luxbase – Automation with Style.
    </footer>

    <!-- Modal & Auth Logic -->
    <script>
      const $ = (id) => document.getElementById(id);
      const modal = $("loginModal");
      const show = (id) => {
        ["loginBox", "registerBox", "resetBox"].forEach((b) => $(b)?.classList.add("hidden"));
        $(id)?.classList.remove("hidden");
      };

      $("openLogin").onclick = () => {
        modal.classList.remove("hidden");
        show("loginBox");
      };
      $("closeLogin").onclick = () => modal.classList.add("hidden");
      modal.onclick = (e) => {
        if (e.target === modal) modal.classList.add("hidden");
      };

      $("linkToRegister").addEventListener("click", () => show("registerBox"));
      $("linkToLogin").addEventListener("click", () => show("loginBox"));
      $("linkToReset").addEventListener("click", () => show("resetBox"));
      $("backToLogin").addEventListener("click", () => show("loginBox"));

      const togglePw = (id) => {
        const el = $(id);
        el.type = el.type === "password" ? "text" : "password";
      };
      $("toggleLoginPw").onclick = () => togglePw("loginPassword");
      $("toggleSignupPw").onclick = () => togglePw("signupPassword");

      // Live‑Validierung beim Registrieren
      $("signupPassword").addEventListener("input", (e) => {
        const v = e.target.value;
        const rules = [
          { t: "Mindestens 8 Zeichen", ok: v.length >= 8 },
          { t: "Mind. ein Großbuchstabe", ok: /[A-Z]/.test(v) },
          { t: "Mind. eine Zahl", ok: /\d/.test(v) },
          { t: "Mind. ein Sonderzeichen", ok: /[^A-Za-z0-9]/.test(v) },
        ];
        $("pwHints").innerHTML = rules
          .map((r) => `<p class="${r.ok ? "text-green-400" : "text-gray-400"}">• ${r.t}</p>`) // eslint-disable-line quotes
          .join("");
      });

      // Login
      $("btnLogin").onclick = async () => {
        const { error } = await supabase.auth.signInWithPassword({
          email: $("loginEmail").value.trim(),
          password: $("loginPassword").value,
        });
        $("loginMsg").textContent = error ? error.message : "";
        if (!error) window.location.href = "/dashboard";
      };
    </script>
  </body>
</html>
