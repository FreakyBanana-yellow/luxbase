---
// KEIN Sidebar-Import mehr
const role = "creator";
const name = "Creator";
---

<html lang="de">
  <head>
    <title>{Astro.props.title || "Luxbase Dashboard"}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
    <meta charset="utf-8" />
    <meta name="theme-color" content="#0d0d0d" />
    <meta id="supabase-config"
      data-url={`${import.meta.env.PUBLIC_SUPABASE_URL}`}
      data-key={`${import.meta.env.PUBLIC_SUPABASE_ANON_KEY}`} />
  </head>

  <body class="bg-luxblack text-white font-sans">
    <!-- Header -->
    <header class="w-full flex justify-between items-center p-4 bg-black border-b border-luxgray sticky top-0 z-50">
      <a href="/" class="text-luxgold font-serif text-xl">LUXBASE</a>
      <div id="accountMenu" class="relative">
        <button id="accountBtn" class="h-11 px-4 border border-luxgold text-luxgold rounded hover:bg-luxgold hover:text-black transition hidden">
          ðŸ‘¤ <span id="username">Account</span>
        </button>
        <div class="absolute right-0 mt-2 w-56 bg-black border border-luxgray rounded-xl shadow-xl text-sm hidden" id="accountDropdown">
          <a href="/dashboard" class="block px-4 py-3 hover:bg-luxgray/30">Dashboard</a>
          <a href="/dashboard/vipbot-einstellungen" class="block px-4 py-3 hover:bg-luxgray/30">Botâ€‘Einstellungen</a>
          <a href="/logs" class="block px-4 py-3 hover:bg-luxgray/30">Logs</a>
          <button id="logoutBtn" class="w-full text-left px-4 py-3 hover:bg-red-900/40 text-red-400">Abmelden</button>
        </div>
      </div>
    </header>

    <!-- Main (ohne Sidebar) -->
    <main class="min-h-screen p-4 md:p-6 pb-24" id="dashboardRoot">
      <slot name="header" />
      <h1 class="text-2xl md:text-3xl font-bold text-luxgold mb-6 md:mb-8" id="welcomeHeadline">
        Willkommen zurÃ¼ck, {name}! ðŸ‘‹
      </h1>
      <slot />
    </main>

    <!-- Bottom Tabs -->
    <nav class="fixed bottom-0 inset-x-0 md:hidden bg-black/90 backdrop-blur border-t border-luxgray z-50">
      <div class="grid grid-cols-4 text-center text-xs">
        <a href="/dashboard" class="py-3 flex flex-col items-center gap-1">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-luxgold" viewBox="0 0 24 24" fill="currentColor"><path d="M3 13h8V3H3v10zm0 8h8v-6H3v6zm10 0h8V11h-8v10zm0-18v6h8V3h-8z"/></svg>
          <span>Start</span>
        </a>
        <a href="/dashboard/vipbot-einstellungen" class="py-3 flex flex-col items-center gap-1">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-luxgold" viewBox="0 0 24 24" fill="currentColor"><path d="M19.14,12.94a7.43,7.43,0,0,0,.05-1,7.43,7.43,0,0,0-.05-1l2.11-1.65a.5.5,0,0,0,.12-.64l-2-3.46a.5.5,0,0,0-.6-.22l-2.49,1a7.45,7.45,0,0,0-1.73-1l-.38-2.65A.5.5,0,0,0,12.5,1h-4a.5.5,0,0,0-.49.42L7.63,4.07a7.45,7.45,0,0,0-1.73,1l-2.49-1a.5.5,0,0,0-.6.22l-2,3.46a.5.5,0,0,0,.12.64L3.14,10a7.43,7.43,0,0,0-.05,1,7.43,7.43,0,0,0,.05,1L1,13.65a.5.5,0,0,0-.12.64l2,3.46a.5.5,0,0,0,.6.22l2.49-1a7.45,7.45,0,0,0,1.73,1l.38,2.65A.5.5,0,0,0,8.5,22h4a.5.5,0,0,0,.49-.42l.38-2.65a7.45,7.45,0,0,0,1.73-1l2.49,1a.5.5,0,0,0,.6-.22l2-3.46a.5.5,0,0,0-.12-.64Z"/></svg>
          <span>Bot</span>
        </a>
        <a href="/logs" class="py-3 flex flex-col items-center gap-1">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-luxgold" viewBox="0 0 24 24" fill="currentColor"><path d="M3 5h18v2H3zm0 6h18v2H3zm0 6h18v2H3z"/></svg>
          <span>Logs</span>
        </a>
        <a href="/profile" class="py-3 flex flex-col items-center gap-1">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-luxgold" viewBox="0 0 24 24" fill="currentColor"><path d="M12 12c2.7 0 5-2.3 5-5s-2.3-5-5-5-5 2.3-5 5 2.3 5 5 5zm0 2c-3.3 0-10 1.7-10 5v3h20v-3c0-3.3-6.7-5-10-5z"/></svg>
          <span>Profil</span>
        </a>
      </div>
    </nav>

    <!-- Client Script -->
    <script type="module">
      import * as supabase_js from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";
      (async () => {
        const meta = document.getElementById("supabase-config");
        const supabase = supabase_js.createClient(meta.dataset.url, meta.dataset.key);
        const { data: { user } } = await supabase.auth.getUser();
        if (!user) { window.location.href = "/"; return; }

        const accountBtn = document.getElementById("accountBtn");
        const accountDropdown = document.getElementById("accountDropdown");
        const usernameEl = document.getElementById("username");
        const logoutBtn = document.getElementById("logoutBtn");
        accountBtn?.classList.remove("hidden");
        usernameEl.textContent = user.email || "Account";
        accountBtn?.addEventListener("click", () => accountDropdown.classList.toggle("hidden"));
        logoutBtn?.addEventListener("click", async () => {
          await supabase.auth.signOut();
          sessionStorage.clear();
          location.href = "/";
        });

        const lux = JSON.parse(sessionStorage.getItem("luxbase_config") || "{}");
        const welcomeHeadline = document.getElementById("welcomeHeadline");
        const fallbackName = lux.role === "agentur" ? "deine Agentur" : "dein Creatorâ€‘Profil";
        welcomeHeadline.textContent = `Willkommen zurÃ¼ck, ${lux.creator_name || fallbackName}! ðŸ‘‹`;
      })();
    </script>
  </body>
</html>
