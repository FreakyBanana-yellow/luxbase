---
import BaseLayout from '../../layouts/BaseLayout.astro'
import AgencyCreateForm from '../../components/AgencyCreateForm.jsx'
import { supabase } from '../../lib/supabase'


const { data: { user } } = await supabase.auth.getUser()
---


<BaseLayout title="Agenturen">
<section class="max-w-5xl mx-auto px-4 py-10">
<h1 class="text-2xl md:text-3xl font-semibold text-yellow-400">Agenturen</h1>
<p class="mt-2 text-zinc-300">Verwalte Teams & Models.</p>


<div class="mt-6 p-4 rounded-2xl bg-zinc-950/60 border border-yellow-600/20">
<h2 class="text-lg text-yellow-300 mb-3">Neue Agentur</h2>
<AgencyCreateForm client:load onCreated={(ag)=>{ location.href = `/agency/${ag.id}/models` }} />
</div>


<div class="mt-8 p-4 rounded-2xl bg-zinc-950/60 border border-yellow-600/20">
<h2 class="text-lg text-yellow-300 mb-3">Meine Agenturen</h2>
<MyAgencies client:load />
</div>
</section>
</BaseLayout>


<script>
import React, { useEffect, useState } from 'react'
import { getMyAgencies } from '../../lib/agency'
function MyAgencies(){
const [rows, setRows] = useState([])
useEffect(()=>{ (async()=> setRows(await getMyAgencies()))() }, [])
return (
<div class="space-y-2">
{rows.map((r) => (
<a href={`/agency/${r.id}/models`} class="block px-4 py-3 rounded-xl bg-zinc-900 border border-yellow-600/20 hover:bg-zinc-800">
<span class="text-yellow-100">{r.name}</span>
<span class="ml-2 text-xs text-zinc-400">({r.role})</span>
</a>
))}
{rows.length===0 && <div class="text-zinc-400">Keine Agentur gefunden.</div>}
</div>
)
}
</script>