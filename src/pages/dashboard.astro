---
import { createClient } from "@supabase/supabase-js";

const supabase = createClient(
  import.meta.env.PUBLIC_SUPABASE_URL,
  import.meta.env.PUBLIC_SUPABASE_ANON_KEY
);

// Session pr√ºfen
const {
  data: { session },
} = await supabase.auth.getSession();

if (!session) {
  return Astro.redirect("/");
}

const { data: profile } = await supabase
  .from("profiles")
  .select("role")
  .eq("id", session.user.id)
  .single();

// Redirect je nach Rolle
if (profile?.role === "agentur") {
  return Astro.redirect("/dashboard-agentur");
} else {
  return Astro.redirect("/dashboard/index");
}
