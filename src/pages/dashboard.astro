---
import BaseLayout from "../layouts/BaseLayout.astro";
title = "Dashboard – Luxbase";
---

<BaseLayout>
  <section class="min-h-[60vh] flex flex-col items-center justify-center gap-6">
    <svg class="animate-spin h-10 w-10 text-luxgold" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
      <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
      <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"></path>
    </svg>
    <p class="text-luxgold/80">Dashboard wird geladen …</p>
  </section>

  <!-- Client-seitige Weiterleitung -->
  <script type="module">
    import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

    const supabase = createClient(
      import.meta.env.PUBLIC_SUPABASE_URL,
      import.meta.env.PUBLIC_SUPABASE_ANON_KEY
    );

    /** Holt die aktuelle Session (JWT) aus dem Browser-Storage */
    const { data: { session } } = await supabase.auth.getSession();

    if (!session) {
      // Kein Login → zurück zur Startseite
      window.location.replace("/");
    } else {
      const role = session.user?.user_metadata?.role ?? "creator";
      if (role === "agentur") {
        window.location.replace("/dashboard-agentur");
      } else {
        window.location.replace("/dashboard-model");
      }
    }
  </script>
</BaseLayout>
